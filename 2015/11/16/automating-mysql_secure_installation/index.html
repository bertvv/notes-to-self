<!doctype html><html lang=en-us>
<head>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"Website","@id":"https:\/\/bertvv.github.io\/notes-to-self","author":{"@type":"Person","name":"Bert Van Vreckem","image":"https://www.gravatar.com/avatar/3972e44f80f0a49eaa277e5a56fa93d2"},"name":"Notes to self","description":"\u003cp\u003eMany HOWTO\u0026rsquo;s and blog posts about installing MySQL\/MariaDB, a LAMP stack, etc. suggest to run the script \u003ccode\u003emysql_secure_installation\u003c\/code\u003e to tighten the security holes in the default installation of the database engine. This includes setting a root password (empty by default), removing anonymous users, and deleting a test database. For a database server that you\u0026rsquo;re going to run in production, it is really important to do this. However, I have a problem with the fact that \u003ccode\u003emysql_secure_installation\u003c\/code\u003e is interactive, i.e. it asks for user input. This makes it very hard to include it in an automated setup. In this post, we\u0026rsquo;ll discuss how the script works and how we can automate what it does.\u003c\/p\u003e","url":"https:\/\/bertvv.github.io\/notes-to-self\/2015\/11\/16\/automating-mysql_secure_installation\/","keywords":"[]"}</script>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=generator content="Hugo 0.88.1 with theme Tranquilpeak 0.5.2-BETA">
<meta name=author content="Bert Van Vreckem">
<meta name=keywords content>
<meta name=description content="Many HOWTO&rsquo;s and blog posts about installing MySQL/MariaDB, a LAMP stack, etc. suggest to run the script mysql_secure_installation to tighten the security holes in the default installation of the database engine. This includes setting a root password (empty by default), removing anonymous users, and deleting a test database. For a database server that you&rsquo;re going to run in production, it is really important to do this. However, I have a problem with the fact that mysql_secure_installation is interactive, i.e. it asks for user input. This makes it very hard to include it in an automated setup. In this post, we&rsquo;ll discuss how the script works and how we can automate what it does.">
<meta property="og:description" content="Many HOWTO&rsquo;s and blog posts about installing MySQL/MariaDB, a LAMP stack, etc. suggest to run the script mysql_secure_installation to tighten the security holes in the default installation of the database engine. This includes setting a root password (empty by default), removing anonymous users, and deleting a test database. For a database server that you&rsquo;re going to run in production, it is really important to do this. However, I have a problem with the fact that mysql_secure_installation is interactive, i.e. it asks for user input. This makes it very hard to include it in an automated setup. In this post, we&rsquo;ll discuss how the script works and how we can automate what it does.">
<meta property="og:type" content="article">
<meta property="og:title" content="Automating `mysql_secure_installation`">
<meta name=twitter:title content="Automating `mysql_secure_installation`">
<meta property="og:url" content="https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/">
<meta property="twitter:url" content="https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/">
<meta property="og:site_name" content="Notes to self">
<meta property="og:description" content="Many HOWTO&rsquo;s and blog posts about installing MySQL/MariaDB, a LAMP stack, etc. suggest to run the script mysql_secure_installation to tighten the security holes in the default installation of the database engine. This includes setting a root password (empty by default), removing anonymous users, and deleting a test database. For a database server that you&rsquo;re going to run in production, it is really important to do this. However, I have a problem with the fact that mysql_secure_installation is interactive, i.e. it asks for user input. This makes it very hard to include it in an automated setup. In this post, we&rsquo;ll discuss how the script works and how we can automate what it does.">
<meta name=twitter:description content="Many HOWTO&rsquo;s and blog posts about installing MySQL/MariaDB, a LAMP stack, etc. suggest to run the script mysql_secure_installation to tighten the security holes in the default installation of the database engine. This includes setting a root password (empty by default), removing anonymous users, and deleting a test database. For a database server that you&rsquo;re going to run in production, it is really important to do this. However, I have a problem with the fact that mysql_secure_installation is interactive, i.e. it asks for user input. This makes it very hard to include it in an automated setup. In this post, we&rsquo;ll discuss how the script works and how we can automate what it does.">
<meta property="og:locale" content="en">
<meta property="article:published_time" content="2015-11-16T16:07:42">
<meta property="article:modified_time" content="2015-11-16T16:07:42">
<meta property="article:section" content="System administration">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="mariadb">
<meta property="article:tag" content="mysql">
<meta name=twitter:card content="summary">
<meta name=twitter:site content="@bertvanvreckem">
<meta name=twitter:creator content="@bertvanvreckem">
<meta property="og:image" content="https://www.gravatar.com/avatar/3972e44f80f0a49eaa277e5a56fa93d2?s=640">
<meta property="twitter:image" content="https://www.gravatar.com/avatar/3972e44f80f0a49eaa277e5a56fa93d2?s=640">
<title>Automating `mysql_secure_installation`</title>
<link rel=icon href=https://bertvv.github.io/notes-to-self/favicon.png>
<link rel=canonical href=https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w==" crossorigin=anonymous referrerpolicy=no-referrer>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha512-H9jrZiiopUdsLpg94A333EfumgUBpO9MdbxStdeITo+KEIMaNfHNvwyjjDJb+ERPaRS6DpyRlKbvPUasNItRyw==" crossorigin=anonymous referrerpolicy=no-referrer>
<link rel=stylesheet href=https://bertvv.github.io/notes-to-self/css/style-c5yjx2losbmkttdif4mskx5f9pqjjquywurgngxfvceyyrtyatseix5hpd.min.css>
</head>
<body>
<div id=blog>
<header id=header data-behavior=4>
<i id=btn-open-sidebar class="fa fa-lg fa-bars"></i>
<div class=header-title>
<a class=header-title-link href=https://bertvv.github.io/notes-to-self/ aria-label>Notes to self</a>
</div>
<a class=header-right-picture href=https://bertvv.github.io/notes-to-self/ aria-label>
<img class=header-picture src="https://www.gravatar.com/avatar/3972e44f80f0a49eaa277e5a56fa93d2?s=90" alt>
</a>
</header>
<nav id=sidebar data-behavior=4>
<div class=sidebar-container>
<div class=sidebar-profile>
<a href=https://bertvv.github.io/notes-to-self/#about aria-label>
<img class=sidebar-profile-picture src="https://www.gravatar.com/avatar/3972e44f80f0a49eaa277e5a56fa93d2?s=110" alt>
</a>
<h4 class=sidebar-profile-name>Bert Van Vreckem</h4>
<h5 class=sidebar-profile-bio>Lecturer ICT at HOGENT</h5>
</div>
<ul class=sidebar-buttons>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://bertvv.github.io/notes-to-self/ title=Home>
<i class="sidebar-button-icon fas fa-lg fa-home" aria-hidden=true></i>
<span class=sidebar-button-desc>Home</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://bertvv.github.io/notes-to-self/categories title=Categories>
<i class="sidebar-button-icon fas fa-lg fa-bookmark" aria-hidden=true></i>
<span class=sidebar-button-desc>Categories</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://bertvv.github.io/notes-to-self/tags title=Tags>
<i class="sidebar-button-icon fas fa-lg fa-tags" aria-hidden=true></i>
<span class=sidebar-button-desc>Tags</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://bertvv.github.io/notes-to-self/archives title=Archives>
<i class="sidebar-button-icon fas fa-lg fa-archive" aria-hidden=true></i>
<span class=sidebar-button-desc>Archives</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://bertvv.github.io/notes-to-self/about title=About>
<i class="sidebar-button-icon fas fa-lg fa-question" aria-hidden=true></i>
<span class=sidebar-button-desc>About</span>
</a>
</li>
</ul>
<ul class=sidebar-buttons>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://github.com/bertvv target=_blank rel=noopener title=GitHub>
<i class="sidebar-button-icon fab fa-lg fa-github" aria-hidden=true></i>
<span class=sidebar-button-desc>GitHub</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://www.linkedin.com/in/bertvanvreckem/ target=_blank rel=noopener title=LinkedIn>
<i class="sidebar-button-icon fab fa-lg fa-linkedin" aria-hidden=true></i>
<span class=sidebar-button-desc>LinkedIn</span>
</a>
</li>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://www.youtube.com/user/bertvvrhogent target=_blank rel=noopener title=Youtube>
<i class="sidebar-button-icon fab fa-lg fa-youtube" aria-hidden=true></i>
<span class=sidebar-button-desc>Youtube</span>
</a>
</li>
</ul>
<ul class=sidebar-buttons>
<li class=sidebar-button>
<a class=sidebar-button-link href=https://bertvv.github.io/notes-to-self/index.xml title=RSS>
<i class="sidebar-button-icon fas fa-lg fa-rss" aria-hidden=true></i>
<span class=sidebar-button-desc>RSS</span>
</a>
</li>
</ul>
</div>
</nav>
<div id=main data-behavior=4 class=hasCoverMetaIn>
<article class=post id=top>
<div class="post-header main-content-wrap text-left">
<h1 class=post-title>
Automating `mysql_secure_installation`
</h1>
<div class="postShorten-meta post-meta">
<time datetime=2015-11-16T16:07:42+01:00>
16 Nov 2015
</time>
<span></span>
<a class=category-link href=https://bertvv.github.io/notes-to-self/categories/system-administration>System administration</a>
</div>
</div>
<div class="post-content markdown">
<div class=main-content-wrap>
<p>Many HOWTO&rsquo;s and blog posts about installing MySQL/MariaDB, a LAMP stack, etc. suggest to run the script <code>mysql_secure_installation</code> to tighten the security holes in the default installation of the database engine. This includes setting a root password (empty by default), removing anonymous users, and deleting a test database. For a database server that you&rsquo;re going to run in production, it is really important to do this. However, I have a problem with the fact that <code>mysql_secure_installation</code> is interactive, i.e. it asks for user input. This makes it very hard to include it in an automated setup. In this post, we&rsquo;ll discuss how the script works and how we can automate what it does.</p>
<p><a href=https://serverfault.com/questions/593508/how-to-pass-input-from-one-script-into-another-using-bash>One approach</a> to automating <code>mysql_secure_installation</code> consists of using the <a href=http://linux.die.net/man/1/expect><code>expect(1)</code></a> tool that can &ldquo;sense&rdquo; when the user is asked for input and can inject the appropriate response. This is a kludge and should be avoided. Expect is written in the scripting language Tcl/Tk, which is typically not installed by default. So installing <code>expect(1)</code> also pulls in dependencies that have no added value to the functionality of the system itself. Installing unneccesary software is a <a href=http://www.cyberciti.biz/tips/linux-security.html>bad security practice</a>. Expect also adds an unnecessary layer of complexity to a script that is already too complicated to begin with. If the <code>mysql_secure_installation</code> script was written in a way that was more friendly towards automation, it wouldn&rsquo;t be needed at all.</p>
<p>A better approach is to have a look at what the script actually does and then automating that. The MariaDB source code is hosted on Github and the <code>mysql_secure_installation</code> script can be <a href=https://github.com/MariaDB/server/blob/5.5/scripts/mysql_secure_installation.sh>found here</a>. The script consists of lots of code to inform the user and interpret user input which are cruft for our purposes. The gems are the SQL statements scattered throughout the code. Look for the string <code>do_query</code> to find them. The queries will perform the following actions:</p>
<ol>
<li>Set a password for the database &ldquo;root&rdquo; user (different from the Linux root user!), which is blank by default;</li>
<li>Delete &ldquo;anonymous&rdquo; users, i.e. users with the empty string as user name;</li>
<li>Ensure the root user can not log in remotely;</li>
<li>Remove the database named &ldquo;test&rdquo;;</li>
<li>Flush the privileges tables, i.e. ensure that the changes to user access applied in the previous steps are committed immediately.</li>
</ol>
<p>There is only one input that should come from the system administrator and that is the database root password. The other steps can be automated without any interaction with the user.</p>
<p>In the sections below, these steps are explained in more detail, and after that, I&rsquo;ll show how to automate them.</p>
<h2 id=setting-the-database-root-password>Setting the database root password</h2>
<p>There&rsquo;s actually (at least) two ways of doing this: using the SQL query (like the <code>mysql_secure_installation</code> script does), or by using the <code>mysqladmin</code> command. The SQL statement can e.g. be executed within the <a href=http://linux.die.net/man/1/mysql><code>mysql(1)</code></a> client tool that can be accessed with the command:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mysql -u root -p</code></pre></div>
<p>The option <code>-u</code> specifies the user (<code>root</code>), the option <code>-p</code> prompts for a password. You can just press ENTER now, but later, when you have set the root password, you will of course need to type it.</p>
<p>The SQL command to set the root password, copied from the script source, is:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>UPDATE</span> mysql.<span style=color:#66d9ef>user</span> <span style=color:#66d9ef>SET</span> Password<span style=color:#f92672>=</span>PASSWORD(<span style=color:#e6db74>&#39;my_new_password&#39;</span>) <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>User</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root&#39;</span>;</code></pre></div>
<p>Replace <code>my_new_password</code> with the desired password.</p>
<p>The alternative method is the <a href=http://linux.die.net/man/1/mysqladmin><code>mysqladmin(1)</code></a> command:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ mysqladmin password <span style=color:#e6db74>&#34;my_new_password&#34;</span></code></pre></div>
<h2 id=delete-anonymous-users>Delete anonymous users</h2>
<p>In the default installation includes anonymous users, apparently for testing. These should be removed before putting the database server into production, as it allows to access the database without a password. Anonymous users have an empty user name and can be deleted with the following SQL statement (from <code>mysql_secure_installation</code>):</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> mysql.<span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>User</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>;</code></pre></div>
<h2 id=ensure-the-root-user-can-not-log-in-remotely>Ensure the root user can not log in remotely</h2>
<p>It&rsquo;s always a good idea to limit access for the database root user to localhost for added security. This won&rsquo;t even affect a setup with <a href=https://www.phpmyadmin.net/>phpMyAdmin</a> if it&rsquo;s installed on the same host!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> mysql.<span style=color:#66d9ef>user</span> <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>User</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#39;root&#39;</span> <span style=color:#66d9ef>AND</span> <span style=color:#66d9ef>Host</span> <span style=color:#66d9ef>NOT</span> <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;localhost&#39;</span>, <span style=color:#e6db74>&#39;127.0.0.1&#39;</span>, <span style=color:#e6db74>&#39;::1&#39;</span>);</code></pre></div>
<h2 id=remove-the-test-database>Remove the test database</h2>
<p>The default installation contains a database with the name <code>test</code> (with associated user privileges). These should also be deleted before putting the database into production:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>DROP</span> <span style=color:#66d9ef>DATABASE</span> test;
<span style=color:#66d9ef>DELETE</span> <span style=color:#66d9ef>FROM</span> mysql.db <span style=color:#66d9ef>WHERE</span> Db<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;test&#39;</span> <span style=color:#66d9ef>OR</span> Db<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;test\_%&#39;</span>;</code></pre></div>
<p>The first statement removes the database, the second privileges on the database.</p>
<h2 id=flush-the-privileges-tables>Flush the privileges tables</h2>
<p>The statements above that change user access to the database <a href=https://dev.mysql.com/doc/refman/5.6/en/privilege-changes.html>have no immediate effect</a>. The following command will commit the changes:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql>FLUSH <span style=color:#66d9ef>PRIVILEGES</span>;</code></pre></div>
<p>Without flushing the privilege tables, the root password will remain unset.</p>
<h2 id=putting-it-all-together>Putting it all together</h2>
<p>We can execute all the SQL statements above with the following code snippet:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>myql --user<span style=color:#f92672>=</span>root <span style=color:#e6db74>&lt;&lt;_EOF_
</span><span style=color:#e6db74>UPDATE mysql.user SET Password=PASSWORD(&#39;${db_root_password}&#39;) WHERE User=&#39;root&#39;;
</span><span style=color:#e6db74>DELETE FROM mysql.user WHERE User=&#39;&#39;;
</span><span style=color:#e6db74>DELETE FROM mysql.user WHERE User=&#39;root&#39; AND Host NOT IN (&#39;localhost&#39;, &#39;127.0.0.1&#39;, &#39;::1&#39;);
</span><span style=color:#e6db74>DROP DATABASE IF EXISTS test;
</span><span style=color:#e6db74>DELETE FROM mysql.db WHERE Db=&#39;test&#39; OR Db=&#39;test\\_%&#39;;
</span><span style=color:#e6db74>FLUSH PRIVILEGES;
</span><span style=color:#e6db74>_EOF_</span></code></pre></div>
<p>The SQL commands are passed to <code>mysql(1)</code> in a <a href=http://tldp.org/LDP/abs/html/here-docs.html>here document</a>. The variable &lsquo;${db_root_password}&rsquo; needs to be set. I&rsquo;ve written a more elaborate shell script that takes the value of the database root password from the command line and has some checks in place. The full source can be found below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#! /bin/sh
</span><span style=color:#75715e></span><span style=color:#75715e>#</span>
<span style=color:#75715e># Author: Bert Van Vreckem &lt;bert.vanvreckem@gmail.com&gt;</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># A non-interactive replacement for mysql_secure_installation</span>
<span style=color:#75715e>#</span>
<span style=color:#75715e># Tested on CentOS 6, CentOS 7, Ubuntu 12.04 LTS (Precise Pangolin), Ubuntu</span>
<span style=color:#75715e># 14.04 LTS (Trusty Tahr).</span>

set -o errexit <span style=color:#75715e># abort on nonzero exitstatus</span>
set -o nounset <span style=color:#75715e># abort on unbound variable</span>

<span style=color:#75715e>#{{{ Functions</span>

usage<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
cat <span style=color:#e6db74>&lt;&lt; _EOF_
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>Usage: ${0} &#34;ROOT PASSWORD&#34;
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>  with &#34;ROOT PASSWORD&#34; the desired password for the database root user.
</span><span style=color:#e6db74>
</span><span style=color:#e6db74>Use quotes if your password contains spaces or other special characters.
</span><span style=color:#e6db74>_EOF_</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e># Predicate that returns exit status 0 if the database root password</span>
<span style=color:#75715e># is set, a nonzero exit status otherwise.</span>
is_mysql_root_password_set<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  ! mysqladmin --user<span style=color:#f92672>=</span>root status &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e># Predicate that returns exit status 0 if the mysql(1) command is available,</span>
<span style=color:#75715e># nonzero exit status otherwise.</span>
is_mysql_command_available<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  which mysql &gt; /dev/null 2&gt;&amp;<span style=color:#ae81ff>1</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e>#}}}</span>
<span style=color:#75715e>#{{{ Command line parsing</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$#<span style=color:#e6db74>&#34;</span> -ne <span style=color:#e6db74>&#34;1&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
  echo <span style=color:#e6db74>&#34;Expected 1 argument, got </span>$#<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span>
  usage
  exit <span style=color:#ae81ff>2</span>
<span style=color:#66d9ef>fi</span>

<span style=color:#75715e>#}}}</span>
<span style=color:#75715e>#{{{ Variables</span>
db_root_password<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>1<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
<span style=color:#75715e>#}}}</span>

<span style=color:#75715e># Script proper</span>

<span style=color:#66d9ef>if</span> ! is_mysql_command_available; <span style=color:#66d9ef>then</span>
  echo <span style=color:#e6db74>&#34;The MySQL/MariaDB client mysql(1) is not installed.&#34;</span>
  exit <span style=color:#ae81ff>1</span>
<span style=color:#66d9ef>fi</span>

<span style=color:#66d9ef>if</span> is_mysql_root_password_set; <span style=color:#66d9ef>then</span>
  echo <span style=color:#e6db74>&#34;Database root password already set&#34;</span>
  exit <span style=color:#ae81ff>0</span>
<span style=color:#66d9ef>fi</span>

mysql --user<span style=color:#f92672>=</span>root <span style=color:#e6db74>&lt;&lt;_EOF_
</span><span style=color:#e6db74>  UPDATE mysql.user SET Password=PASSWORD(&#39;${db_root_password}&#39;) WHERE User=&#39;root&#39;;
</span><span style=color:#e6db74>  DELETE FROM mysql.user WHERE User=&#39;&#39;;
</span><span style=color:#e6db74>  DELETE FROM mysql.user WHERE User=&#39;root&#39; AND Host NOT IN (&#39;localhost&#39;, &#39;127.0.0.1&#39;, &#39;::1&#39;);
</span><span style=color:#e6db74>  DROP DATABASE IF EXISTS test;
</span><span style=color:#e6db74>  DELETE FROM mysql.db WHERE Db=&#39;test&#39; OR Db=&#39;test\\_%&#39;;
</span><span style=color:#e6db74>  FLUSH PRIVILEGES;
</span><span style=color:#e6db74>_EOF_</span></code></pre></div>
<p>I also put the script on Github, in my <a href=https://github.com/bertvv/scripts/>scripts repository</a>. If I modify/improve the script in the future, you can find the newer versions there.</p>
<h2 id=conclusion>Conclusion</h2>
<p>The <code>mysql_secure_installation</code> script makes the installation of MariaDB/MySQL more secure and the actions that it performs <em>should always</em> be applied to database servers that you put into production. However, by making the script interactive, it has become unnecessarily complicated. Worse, it&rsquo;s an obstruction in our quest to &ldquo;Automate All the Things(TM)&rdquo;.</p>
<p>I&rsquo;m certainly <a href=https://gist.github.com/Mins/4602864#gistcomment-1294952>not the first one</a> to suggest a non-interactive script that does the same as <code>mysql_secure_installation</code>, but I haven&rsquo;t seen this approach actually being encouraged. I hope this post at least adds to the discussion.</p>
</div>
</div>
<div id=post-footer class="post-footer main-content-wrap">
<div class=post-footer-tags>
<span class="text-color-light text-small"></span><br>
<a class="tag tag--primary tag--small" href=https://bertvv.github.io/notes-to-self/tags/linux/>linux</a>
<a class="tag tag--primary tag--small" href=https://bertvv.github.io/notes-to-self/tags/mariadb/>mariadb</a>
<a class="tag tag--primary tag--small" href=https://bertvv.github.io/notes-to-self/tags/mysql/>mysql</a>
</div>
<div class=post-actions-wrap>
<nav>
<ul class="post-actions post-action-nav">
<li class=post-action>
<a class="post-action-btn btn btn--default tooltip--top" href=https://bertvv.github.io/notes-to-self/2015/12/11/testing-ansible-roles-with-travis-ci-part-1-centos/ data-tooltip="Testing Ansible roles with Travis-CI, Part 1: CentOS" aria-label=": Testing Ansible roles with Travis-CI, Part 1: CentOS">
<i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml"></span>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default tooltip--top" href=https://bertvv.github.io/notes-to-self/2015/10/18/the-number-of-hard-links-in-ls-l/ data-tooltip="The number of hard links in ‘ls -l’" aria-label=": The number of hard links in ‘ls -l’">
<span class="hide-xs hide-sm text-small icon-mr"></span>
<i class="fa fa-angle-right"></i>
</a>
</li>
</ul>
</nav>
<ul class="post-actions post-action-share">
<li class="post-action hide-lg hide-md hide-sm">
<a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label>
<i class="fa fa-share-alt" aria-hidden=true></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/" title aria-label>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/" title aria-label>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://www.reddit.com/submit?url=https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/" title aria-label>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default" href=#top aria-label>
<i class="fa fa-arrow-up" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
<div id=disqus_thread>
<noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
</div>
<script type=text/javascript>var disqus_config=function(){this.page.url='https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/',this.page.identifier='/2015/11/16/automating-mysql_secure_installation/'};(function(){var a,b;if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}a=document.createElement('script'),a.type='text/javascript',a.async=!0,b='',a.src='//'+b+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(a)})()</script>
</div>
</article>
<footer id=footer class=main-content-wrap>
<span class=copyrights>
&copy; 2021 <a href=https://github.com/bertvv>Bert Van Vreckem</a> <a href=https://creativecommons.org/licenses/by/4.0/>CC-BY</a>.
</span>
</footer>
</div>
<div id=bottom-bar class=post-bottom-bar data-behavior=4>
<div class=post-actions-wrap>
<nav>
<ul class="post-actions post-action-nav">
<li class=post-action>
<a class="post-action-btn btn btn--default tooltip--top" href=https://bertvv.github.io/notes-to-self/2015/12/11/testing-ansible-roles-with-travis-ci-part-1-centos/ data-tooltip="Testing Ansible roles with Travis-CI, Part 1: CentOS" aria-label=": Testing Ansible roles with Travis-CI, Part 1: CentOS">
<i class="fa fa-angle-left"></i>
<span class="hide-xs hide-sm text-small icon-ml"></span>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default tooltip--top" href=https://bertvv.github.io/notes-to-self/2015/10/18/the-number-of-hard-links-in-ls-l/ data-tooltip="The number of hard links in ‘ls -l’" aria-label=": The number of hard links in ‘ls -l’">
<span class="hide-xs hide-sm text-small icon-mr"></span>
<i class="fa fa-angle-right"></i>
</a>
</li>
</ul>
</nav>
<ul class="post-actions post-action-share">
<li class="post-action hide-lg hide-md hide-sm">
<a class="post-action-btn btn btn--default btn-open-shareoptions" href=#btn-open-shareoptions aria-label>
<i class="fa fa-share-alt" aria-hidden=true></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://twitter.com/intent/tweet?text=https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/" title aria-label>
<i class="fab fa-twitter" aria-hidden=true></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/" title aria-label>
<i class="fab fa-linkedin" aria-hidden=true></i>
</a>
</li>
<li class="post-action hide-xs">
<a class="post-action-btn btn btn--default" target=new href="https://www.reddit.com/submit?url=https://bertvv.github.io/notes-to-self/2015/11/16/automating-mysql_secure_installation/" title aria-label>
<i class="fab fa-reddit" aria-hidden=true></i>
</a>
</li>
<li class=post-action>
<a class="post-action-btn btn btn--default" href=#top aria-label>
<i class="fa fa-arrow-up" aria-hidden=true></i>
</a>
</li>
</ul>
</div>
</div>
<div id=share-options-bar class=share-options-bar data-behavior=4>
<i id=btn-close-shareoptions class="fa fa-times"></i>
<ul class=share-options>
<li class=share-option>
<a class=share-option-btn target=new href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fbertvv.github.io%2Fnotes-to-self%2F2015%2F11%2F16%2Fautomating-mysql_secure_installation%2F" aria-label>
<i class="fab fa-twitter" aria-hidden=true></i><span></span>
</a>
</li>
<li class=share-option>
<a class=share-option-btn target=new href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fbertvv.github.io%2Fnotes-to-self%2F2015%2F11%2F16%2Fautomating-mysql_secure_installation%2F" aria-label>
<i class="fab fa-linkedin" aria-hidden=true></i><span></span>
</a>
</li>
<li class=share-option>
<a class=share-option-btn target=new href="https://www.reddit.com/submit?url=https%3A%2F%2Fbertvv.github.io%2Fnotes-to-self%2F2015%2F11%2F16%2Fautomating-mysql_secure_installation%2F" aria-label>
<i class="fab fa-reddit" aria-hidden=true></i><span></span>
</a>
</li>
</ul>
</div>
<div id=share-options-mask class=share-options-mask></div>
</div>
<div id=about>
<div id=about-card>
<div id=about-btn-close>
<i class="fa fa-times"></i>
</div>
<img id=about-card-picture src="https://www.gravatar.com/avatar/3972e44f80f0a49eaa277e5a56fa93d2?s=110" alt>
<h4 id=about-card-name>Bert Van Vreckem</h4>
<div id=about-card-bio>Lecturer ICT at HOGENT</div>
<div id=about-card-job>
<i class="fa fa-briefcase"></i>
<br>
Lecturer ICT at HOGENT
</div>
<div id=about-card-location>
<i class="fa fa-map-marker-alt"></i>
<br>
Ghent
</div>
</div>
</div>
<div id=cover style=background-image:url(https://bertvv.github.io/notes-to-self/img/field.jpg)></div>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/highlight.min.js integrity="sha512-z+/WWfyD5tccCukM4VvONpEtLmbAm5LDu7eKiyMQJ9m7OfPEDL7gENyDRL3Yfe8XAuGsS2fS4xSMnl6d30kqGQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha512-uURl+ZXMBrF4AwGaWmEetzrd+J5/8NRkWAvJx5sbPSSuOb0bZLqf+tOzniObO00BjHa/dD7gub9oCGMLPQHtQA==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://bertvv.github.io/js/script-yqzy9wdlzix4lbbwdnzvwx3egsne77earqmn73v9uno8aupuph8wfguccut.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-gE8KAQyFIzV1C9+GZ8TKJHZS2s+n7EjNtC+IMRn1l5+WYJTHOODUM6JSjZhFhqXmc7bG8Av6XXpckA4tYhflnw==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/apache.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-EWROca+bote+7Oaaar1F6y74iZj1r1F9rm/ly7o+/FwJopbBaWtsFDmaKoZDd3QiGU2pGacBirHJNivmGLYrow==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/go.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-GDVzAn0wpx1yVtQsRWmFc6PhJiLBPdUic+h4GWgljBh904O3JU10fk9EKNpVyIoPqkFn54rgL2QBG4BmUTMpiQ==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/http.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-UgZlma8NzkrDb/NWgmLIcTrH7i/CSnLLDRFqCSNF5NGPpjKmzyM25qcoXGOup8+cDakKyaiTDd7N4dyH4YT+IA==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/less.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-lot9koe73sfXIrUvIPM/UEhuMciN56RPyBdOyZgfO53P2lkWyyXN7J+njcxIIBRV+nVDQeiWtiXg+bLAJZDTfg==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/nginx.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-Zd3e7XxHP00TD0Imr0PIfeM0fl0v95kMWuhyAS3Wn1UTSXTkz0OhtRgBAr4JlmADRgiXr4x7lpeUdqaGN8xIog==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/puppet.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-qtqDO052iXMSP+5d/aE/jMtL9vIIGvONgTJziC2K/ZIB1yEGa55WVxGE9/08rSQ62EoDifS9SWVGZ7ihSLhzMA==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/scss.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-1NmkjnEDnwwwcu28KoQF8vs3oaPFokQHbmbtwGhFfeDsQZtVFI8zW2aE9O8yMYdpdyKV/5blE4pSWw4Z/Sv97w==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/stylus.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-B2wSfruPjr8EJL6IIzQr1eAuDwrsfIfccNf/LCEdxELCgC/S/ZMt/Uvk80aD79m7IqOqW+Sw8nbkvha20yZpzg==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/swift.min.js></script>
<script async crossorigin=anonymous defer integrity="sha512-28oDiQZGKUVN6wQ7PSLPNipOcmkCALXKwOi7bnkyFf8QiMZQxG9EQoy/iiNx6Zxj2cG2SbVa4dXKigQhu7GiFw==" src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.1.0/languages/yaml.min.js></script>
<script>$(document).ready(function(){hljs.configure({classPrefix:'',useBR:!1}),$('pre.code-highlight > code, pre > code').each(function(b,a){$(this).hasClass('codeblock')||$(this).addClass('codeblock'),hljs.highlightBlock(a)})})</script>
</body>
</html>